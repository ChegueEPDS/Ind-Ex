<div class="container">
    <h2>XLSx Compare Tool</h2>

    <div class="grid-container">
        <!-- Eredeti f√°jl felt√∂lt√©se -->
        <div class="grid-item"
                matRipple 
                [matRippleDisabled]="loading()" 
                [class.disabled]="loading()" 
                (click)="!loading() && fileInput1.click()">
            <input #fileInput1 type="file" (change)="onFileChange($event, 1)" accept=".xlsx" hidden /> 
                <mat-icon class="bigicon">upload</mat-icon> <h3>Original File</h3>
            <p *ngIf="file1()">üìÑ {{ file1()?.name }}</p>
        </div>

        <!-- √öj f√°jl felt√∂lt√©se -->
        <div class="grid-item" 
            matRipple 
            [matRippleDisabled]="loading()" 
            [class.disabled]="loading()" 
            (click)="!loading() && fileInput2.click()">
            <input #fileInput2 type="file" (change)="onFileChange($event, 2)" accept=".xlsx" hidden />
                <mat-icon class="bigicon">upload</mat-icon> <h3>New File</h3>
            <p *ngIf="file2()">üìÑ {{ file2()?.name }}</p>
        </div>

        <!-- Azonos√≠t√≥ oszlop kiv√°laszt√°sa -->
        <div class="grid-item" [class.disabled]="loading()">
            <h3 style="align-self: flex-start; margin-bottom: 8px;">ID Column</h3>
            <mat-form-field appearance="outline">
                <mat-select [(ngModel)]="columnLetter" [disabled]="loading()">
                    <mat-option *ngFor="let letter of availableColumns" [value]="letter">
                        {{ letter }}
                    </mat-option>
                </mat-select>
            </mat-form-field>
        </div>

        <!-- √ñsszehasonl√≠t√°s gomb -->
        <div class="grid-item" 
            matRipple 
            [matRippleDisabled]="loading()" 
            [class.disabled]="loading()" 
            (click)="!loading() && compareFiles()">
            <mat-icon class="bigicon">compare</mat-icon> 
            <h3>Compare Files</h3>
        </div>
    </div>

    <!--mat-divider *ngIf="responseReceived()"></mat-divider-->

    <!-- Az √∂sszehasonl√≠t√°s eredm√©nye √©s AI elemz√©s oszlopai -->
    <div class="summary-container">
    
        <!-- Spinner megjelen√©se anim√°ci√≥val -->
        <div class="spinner-container" *ngIf="loading()">
            <mat-progress-spinner mode="indeterminate"></mat-progress-spinner>
        </div>
    
        <!-- Eredm√©nyek √©s AI elemz√©s csak ha van adat -->
        <div class="result-container" [class.show]="!loading() && (comparisonResult().length > 0)"
             *ngIf="!loading() && (comparisonResult().length > 0)">
            <!-- √ñsszehasonl√≠t√°s eredm√©nye -->
            <div class="summary-column">
                <h3>Comparison Result:</h3>
                <p *ngFor="let change of sanitizedComparisonResult()" [innerHTML]="change"></p>
            </div>
    
            <!-- Elv√°laszt√≥ vonal -->
            <div class="divider"></div>
    
            <!-- AI Sz√∂veges elemz√©s -->
            <div class="download-column">
                <h3>Downlod comparison Eccel:</h3>
                <button mat-icon-button class="xlsbutton" (click)="downloadXlsx()">
                    <mat-icon class="custom-mat-icon">
                        <img src="public/xlsx_icon.svg" alt="XLSX logo">
                      </mat-icon>
                </button>
            </div>
        </div>
    
    </div>

    <!-- Ha nincs elt√©r√©s -->
    <div *ngIf="!loading() && responseReceived() && comparisonResult().length === 0">
        <h3>‚úîÔ∏è No difference between the two tables.</h3>
    </div>

    <!-- Let√∂lt√©s gomb k√∂z√©pen -->
    <div class="download-container" *ngIf="downloadUrl() && comparisonResult().length > 0">
        <a mat-button color="accent" [href]="downloadUrl()" download>
            <mat-icon>download</mat-icon> Download XLSX
        </a>
    </div>
</div>